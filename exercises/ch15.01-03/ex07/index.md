# 解答

## エラーになる理由

- クリックジャッジング
  - ユーザーが意図しない操作をさせるために、透明なiframeなどで他サイトを自分のサイトに重ねて表示し、ユーザーのクリックをだまし取る攻撃
  - 対策として、サイト側はHTTPヘッダーX-Frame-Options: DENYやContent-Security-Policy: frame-ancestors 'none'を設定し、他サイトからiframeに取り込まれることを禁止する
  - YouTubeはこれを実施しているため、自身のiframeからDOMにアクセスすることはそもそも許可しないため、エラーになる
- script.jsも動かない理由
  - 上記の理由でiframe内にアクセスしようとすると同一オリジンポリシー(SOP, Same-Origin Policy)に違反してブラウザがブロックする
  - contentWindow.querySelectorAll()は自サイトのオリジンと異なるサイトにはアクセス不可
  - そのため、iframe内のＤＯＭを操作しようとするとJavaScript側でエラーが発生して、それ以降の処理も止まる
- SOPが存在しない場合
  - 想定される被害例
    - ユーザー情報の窃取
      - YouTubeのログイン情報やクッキー、おすすめ動画などの個人情報情報に自由にアクセス可能
      - 外部サイトでユーザーの行動履歴や個人情報が抜き取られる
    - 改ざん・フィッシング
      - iframe内の表示内容を書き換え、ユーザーに偽のボタンや広告をクリックさせることが可能
      - 本物のサイトに見せかけて詐欺行為が行える
    - マルウェア配布
      - 外部サイトのiframeを操作して不正スクリプトを挿入し、ユーザーにマルウェアを実行させることも可能
    - サプライチェーン攻撃
      - 他サイトのJSを勝手に書き換えて、自サイトだけでなくほかのユーザーの利用環境も攻撃可能
