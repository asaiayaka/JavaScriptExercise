<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>One Driveへファイルアップロード</title>
  </head>
</html>
<body>
<h2>One Driveへファイルアップロード</h2>

<!-- アクセストークン入力欄 -->
<label>アクセストークン(Bearer Token)</label><br />
<input id="token" type="text" style="width: 80%" /><br /><br />

<!-- ファイル選択 -->
<label>アップロードするファイル</label>
<input id="fileInput" type="file" /><br /><br />

<!-- アップロードボタン -->
<button onclick="uploadFile()">アップロード</button>

<p id="result"></p>

<script>
  // OneDriveへアップロードする処理
  async function uploadFile() {
    // ユーザーが入力したアクセストークンを取得
    const token = document.getElementById("token").value;

    // ファイル選択情報
    const file = document.getElementById("fileInput").files[0];

    // 入力チェック
    if (!token) {
      alert("アクセストークンを入力してください");
      return;
    }
    if (!file) {
      alert("ファイルを選択してください");
      return;
    }

    // OneDrive のアップロード先URL
    // /drive/root:/ ファイル名:/content とすることでルートにアップロード可能
    const uploadUrl = `https://graph.microsoft.com/v1.0/me/drive/root:/${file.name}:/content`;

    // fetch APIを使ってアップロード実行
    try {
        const response = await fetch(uploadUrl, {
            method: "PUT", 
            headers: {
                "Authorization": "Bearer " + token,
                // Content-typeは自動判別のため指定不要
            },
            body: file
        });

        const resultTxt = document.getElementById("result");

        // アップロード成功時
        if (response.ok) {
            const data = await response.json();
            resultTxt.innerText = "アップロード完了: " + data.name;
        } else {
            // 失敗時
            const text = await response.text();
            resultTxt.innerText = "エラー\n" + text;
        }
    } catch (e) {
        document.getElementById("result").innerText = "通信エラー: " + e;
    }
  }
</script>
</body>
</html>